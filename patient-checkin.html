<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Be Well Check-In System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #0f1419;
            color: white;
            height: 100vh;
            overflow: hidden;
        }

        /* Common styles */
        .screen {
            display: none;
            height: 100vh;
        }

        .screen.active {
            display: flex;
            flex-direction: column;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.2rem;
            margin: 10px;
        }

        .btn-primary {
            background: #A47C5B;
            color: white;
        }

        .btn-secondary {
            background: #666;
            color: white;
        }

        /* Wizard Step System */
        .wizard-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            max-height: 100vh;
            padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
            overflow: hidden;
        }
        
        .progress-bar {
            height: 8px;
            background: rgba(164, 124, 91, 0.2);
            position: relative;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: #A47C5B;
            transition: width 0.3s ease;
            width: 20%;
        }
        
        .question-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 10px 20px;
            text-align: center;
            min-height: 0;
        }
        
        .question-area h1 {
            font-size: clamp(2rem, 5vw, 3rem);
            font-weight: 300;
            margin-bottom: 15px;
            color: #A47C5B;
        }
        
        .question-area p {
            font-size: clamp(1rem, 3vw, 1.5rem);
            opacity: 0.8;
            margin-bottom: 20px;
        }
        
        .input-display {
            width: 80%;
            max-width: 600px;
            padding: 20px;
            font-size: clamp(1.5rem, 4vw, 2.5rem);
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(164, 124, 91, 0.5);
            border-radius: 16px;
            text-align: center;
            color: white;
            margin-bottom: 20px;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .input-display.empty {
            color: rgba(255, 255, 255, 0.3);
        }
        
        .keyboard-container {
            background: rgba(0, 0, 0, 0.8);
            padding: 15px;
            border-top: 1px solid rgba(164, 124, 91, 0.3);
            flex-shrink: 0;
        }
        
        .keyboard {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            gap: 8px;
            max-width: 1000px;
            margin: 0 auto;
        }
        
        .key {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 15px 8px;
            font-size: clamp(1.2rem, 2.5vw, 1.8rem);
            color: white;
            cursor: pointer;
            transition: all 0.1s;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 50px;
        }
        
        .key:active {
            background: rgba(164, 124, 91, 0.5);
            transform: scale(0.95);
        }
        
        .key.space {
            grid-column: span 5;
        }
        
        .key.backspace {
            grid-column: span 2;
            background: rgba(239, 68, 68, 0.2);
        }
        
        .key.next {
            grid-column: span 3;
            background: #A47C5B;
            font-weight: bold;
        }
        
        .step {
            display: none;
        }
        
        .step.active {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }
        
        .yes-no-container {
            display: flex;
            gap: 40px;
        }
        
        .yes-no-btn {
            padding: 40px 80px;
            font-size: 2.5rem;
            background: rgba(255, 255, 255, 0.1);
            border: 3px solid rgba(164, 124, 91, 0.5);
            border-radius: 20px;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .yes-no-btn:active {
            transform: scale(0.95);
        }
        
        .yes-no-btn.yes:hover {
            background: #22c55e;
            border-color: #22c55e;
        }
        
        .yes-no-btn.no:hover {
            background: #ef4444;
            border-color: #ef4444;
        }
        
        .service-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            width: 80%;
            max-width: 800px;
        }
        
        .service-btn {
            padding: 30px;
            font-size: 1.8rem;
            background: rgba(255, 255, 255, 0.1);
            border: 3px solid rgba(164, 124, 91, 0.5);
            border-radius: 16px;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .service-btn:hover {
            background: rgba(164, 124, 91, 0.3);
            border-color: #A47C5B;
        }
        
        .hidden {
            display: none !important;
        }
        
        @keyframes scaleIn {
            from { transform: scale(0); }
            to { transform: scale(1); }
        }

        /* Dashboard Screen */
        .dashboard-screen {
            padding: 20px;
        }

        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(164, 124, 91, 0.1);
            border-radius: 12px;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(164, 124, 91, 0.1);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #A47C5B;
        }

        .checkins-table {
            background: rgba(164, 124, 91, 0.1);
            border-radius: 12px;
            overflow: hidden;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid rgba(164, 124, 91, 0.2);
        }

        th {
            background: rgba(164, 124, 91, 0.3);
            font-weight: bold;
            color: #A47C5B;
        }

        .status-waiting {
            color: #f59e0b;
            font-weight: bold;
        }

        .mode-switcher {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <!-- Kiosk Screen -->
    <div id="kioskScreen" class="screen active">
        <div class="wizard-container">
            <div class="progress-bar">
                <div class="progress-fill" id="progressBar"></div>
            </div>
            
            <!-- Step 1: Name -->
            <div class="step active" id="step1">
                <div class="question-area">
                    <h1>What's your name?</h1>
                    <p>Please enter your full name</p>
                    <div class="input-display empty" id="nameDisplay">Type your name...</div>
                </div>
                <div class="keyboard-container">
                    <div class="keyboard">
                        <button class="key" onclick="addLetter('Q')">Q</button>
                        <button class="key" onclick="addLetter('W')">W</button>
                        <button class="key" onclick="addLetter('E')">E</button>
                        <button class="key" onclick="addLetter('R')">R</button>
                        <button class="key" onclick="addLetter('T')">T</button>
                        <button class="key" onclick="addLetter('Y')">Y</button>
                        <button class="key" onclick="addLetter('U')">U</button>
                        <button class="key" onclick="addLetter('I')">I</button>
                        <button class="key" onclick="addLetter('O')">O</button>
                        <button class="key" onclick="addLetter('P')">P</button>
                        
                        <button class="key" onclick="addLetter('A')">A</button>
                        <button class="key" onclick="addLetter('S')">S</button>
                        <button class="key" onclick="addLetter('D')">D</button>
                        <button class="key" onclick="addLetter('F')">F</button>
                        <button class="key" onclick="addLetter('G')">G</button>
                        <button class="key" onclick="addLetter('H')">H</button>
                        <button class="key" onclick="addLetter('J')">J</button>
                        <button class="key" onclick="addLetter('K')">K</button>
                        <button class="key" onclick="addLetter('L')">L</button>
                        <button class="key backspace" onclick="backspace()">←</button>
                        
                        <button class="key" onclick="addLetter('Z')">Z</button>
                        <button class="key" onclick="addLetter('X')">X</button>
                        <button class="key" onclick="addLetter('C')">C</button>
                        <button class="key" onclick="addLetter('V')">V</button>
                        <button class="key" onclick="addLetter('B')">B</button>
                        <button class="key" onclick="addLetter('N')">N</button>
                        <button class="key" onclick="addLetter('M')">M</button>
                        <button class="key next" onclick="nextStep()">NEXT →</button>
                        
                        <button class="key space" onclick="addLetter(' ')">SPACE</button>
                    </div>
                </div>
            </div>
            
            <!-- Step 2: Phone -->
            <div class="step" id="step2">
                <div class="question-area">
                    <h1>Your phone number?</h1>
                    <p>We'll text you when you're ready</p>
                    <div class="input-display empty" id="phoneDisplay">(___) ___-____</div>
                </div>
                <div class="keyboard-container">
                    <div class="keyboard" style="grid-template-columns: repeat(3, 1fr); max-width: 400px;">
                        <button class="key" onclick="addNumber('1')">1</button>
                        <button class="key" onclick="addNumber('2')">2</button>
                        <button class="key" onclick="addNumber('3')">3</button>
                        <button class="key" onclick="addNumber('4')">4</button>
                        <button class="key" onclick="addNumber('5')">5</button>
                        <button class="key" onclick="addNumber('6')">6</button>
                        <button class="key" onclick="addNumber('7')">7</button>
                        <button class="key" onclick="addNumber('8')">8</button>
                        <button class="key" onclick="addNumber('9')">9</button>
                        <button class="key backspace" onclick="backspacePhone()">←</button>
                        <button class="key" onclick="addNumber('0')">0</button>
                        <button class="key next" onclick="nextStep()">NEXT →</button>
                    </div>
                </div>
            </div>
            
            <!-- Step 3: First Visit -->
            <div class="step" id="step3">
                <div class="question-area">
                    <h1>Is this your first visit?</h1>
                    <p>Have you been to Be Well before?</p>
                    <div class="yes-no-container">
                        <button class="yes-no-btn yes" onclick="setFirstVisit('YES')">YES<br><small>First Time</small></button>
                        <button class="yes-no-btn no" onclick="setFirstVisit('NO')">NO<br><small>Been Here</small></button>
                    </div>
                </div>
            </div>
            
            <!-- Step 4: Service -->
            <div class="step" id="step4">
                <div class="question-area">
                    <h1>What service are you here for?</h1>
                    <p>Select your primary service</p>
                    <div class="service-grid">
                        <button class="service-btn" onclick="selectService('Chiropractic')">Chiropractic</button>
                        <button class="service-btn" onclick="selectService('Massage')">Massage</button>
                        <button class="service-btn" onclick="selectService('Colon Hydrotherapy')">Colon Hydrotherapy</button>
                        <button class="service-btn" onclick="selectService('IV Therapy')">IV Therapy</button>
                        <button class="service-btn" onclick="selectService('Injections')">Injections</button>
                        <button class="service-btn" onclick="selectService('Consultation')">Consultation</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Success Screen -->
        <div class="success-screen" id="successScreen" style="display: none; flex-direction: column; justify-content: center; align-items: center; height: 100vh; text-align: center;">
            <div style="width: 120px; height: 120px; background: #22c55e; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 4rem; margin-bottom: 30px; animation: scaleIn 0.5s ease;">✓</div>
            <h1 style="font-size: 3rem; margin-bottom: 20px;">You're all checked in!</h1>
            <p style="font-size: 1.5rem; opacity: 0.8; margin-bottom: 40px;">Please have a seat and we'll call you shortly.</p>
            <p style="font-size: 1.2rem; opacity: 0.6;">This screen will reset in <span id="countdown">10</span> seconds...</p>
        </div>
    </div>

    <!-- Dashboard Screen -->
    <div id="dashboardScreen" class="screen dashboard-screen">
        <div class="dashboard-header">
            <h1>Front Desk Dashboard</h1>
            <div>
                <span id="currentTime"></span>
                <button class="btn btn-primary" onclick="refreshDashboard()">Refresh</button>
            </div>
        </div>

        <div class="stats">
            <div class="stat-card">
                <div class="stat-number" id="waitingCount">0</div>
                <div>Waiting</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalCount">0</div>
                <div>Total Today</div>
            </div>
        </div>

        <div class="checkins-table">
            <table>
                <thead>
                    <tr>
                        <th>Time</th>
                        <th>Name</th>
                        <th>Phone</th>
                        <th>Service</th>
                        <th>First Visit</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="checkinsTableBody">
                    <!-- Data populated by JavaScript -->
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // Single data store
        let checkins = [];

        // Load data from localStorage on start
        function loadData() {
            const saved = localStorage.getItem('allCheckins');
            if (saved) {
                checkins = JSON.parse(saved);
            }
        }

        // Save data to localStorage
        function saveData() {
            localStorage.setItem('allCheckins', JSON.stringify(checkins));
            console.log('SAVED TO LOCALSTORAGE:', checkins.length, 'items');
            console.log('KEY: allCheckins');
            console.log('DATA:', JSON.stringify(checkins));
        }

        // Switch between modes
        function switchToKiosk() {
            document.getElementById('kioskScreen').classList.add('active');
            document.getElementById('dashboardScreen').classList.remove('active');
        }

        function switchToDashboard() {
            document.getElementById('kioskScreen').classList.remove('active');
            document.getElementById('dashboardScreen').classList.add('active');
            refreshDashboard();
        }

        // Wizard variables
        let currentStep = 1;
        let formData = {
            name: '',
            phone: '',
            phoneRaw: '',
            firstVisit: '',
            service: ''
        };

        // Update progress bar
        function updateProgress() {
            const progress = (currentStep / 4) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
        }

        // Name input functions
        function addLetter(letter) {
            formData.name += letter;
            updateNameDisplay();
        }

        function backspace() {
            formData.name = formData.name.slice(0, -1);
            updateNameDisplay();
        }

        function updateNameDisplay() {
            const display = document.getElementById('nameDisplay');
            if (formData.name) {
                display.textContent = formData.name;
                display.classList.remove('empty');
            } else {
                display.textContent = 'Type your name...';
                display.classList.add('empty');
            }
        }

        // Phone input functions
        function addNumber(num) {
            if (formData.phoneRaw.length < 10) {
                formData.phoneRaw += num;
                updatePhoneDisplay();
            }
        }

        function backspacePhone() {
            formData.phoneRaw = formData.phoneRaw.slice(0, -1);
            updatePhoneDisplay();
        }

        function updatePhoneDisplay() {
            const display = document.getElementById('phoneDisplay');
            const raw = formData.phoneRaw;
            
            if (raw.length === 0) {
                display.textContent = '(___) ___-____';
                display.classList.add('empty');
            } else {
                let formatted = '(';
                for (let i = 0; i < 10; i++) {
                    if (i < raw.length) {
                        formatted += raw[i];
                    } else {
                        formatted += '_';
                    }
                    if (i === 2) formatted += ') ';
                    if (i === 5) formatted += '-';
                }
                display.textContent = formatted;
                display.classList.remove('empty');
                
                if (raw.length === 10) {
                    formData.phone = `(${raw.slice(0,3)}) ${raw.slice(3,6)}-${raw.slice(6,10)}`;
                }
            }
        }

        // Navigation functions
        function nextStep() {
            if (currentStep === 1 && !formData.name.trim()) return;
            if (currentStep === 2 && formData.phoneRaw.length !== 10) return;
            
            document.getElementById('step' + currentStep).classList.remove('active');
            currentStep++;
            if (currentStep <= 4) {
                document.getElementById('step' + currentStep).classList.add('active');
                updateProgress();
            }
        }

        function setFirstVisit(value) {
            formData.firstVisit = value;
            nextStep();
        }

        function selectService(service) {
            formData.service = service;
            submitCheckIn();
        }

        function submitCheckIn() {
            const checkinData = {
                id: Date.now().toString(),
                name: formData.name,
                phone: formData.phone,
                firstVisit: formData.firstVisit,
                service: formData.service,
                timeIn: new Date().toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' }),
                dateIn: new Date().toISOString().split('T')[0],
                status: 'waiting',
                timestamp: new Date().toISOString()
            };

            // Add to array
            checkins.push(checkinData);
            
            // Save to localStorage
            saveData();
            
            // Show success screen
            document.getElementById('kioskScreen').style.display = 'none';
            document.getElementById('successScreen').style.display = 'flex';
            
            // Countdown and reset
            let countdown = 10;
            const countdownInterval = setInterval(() => {
                countdown--;
                document.getElementById('countdown').textContent = countdown;
                
                if (countdown === 0) {
                    clearInterval(countdownInterval);
                    
                    // Reset everything
                    document.getElementById('successScreen').style.display = 'none';
                    document.getElementById('kioskScreen').style.display = 'flex';
                    
                    // Reset wizard
                    formData = { name: '', phone: '', phoneRaw: '', firstVisit: '', service: '' };
                    currentStep = 1;
                    document.querySelectorAll('.step').forEach(step => step.classList.remove('active'));
                    document.getElementById('step1').classList.add('active');
                    updateProgress();
                    updateNameDisplay();
                    updatePhoneDisplay();
                    
                    // Reset countdown
                    document.getElementById('countdown').textContent = '10';
                }
            }, 1000);
            
            console.log('Check-in saved:', checkinData);
            console.log('Total check-ins:', checkins.length);
        }

        // Refresh dashboard
        function refreshDashboard() {
            const today = new Date().toISOString().split('T')[0];
            const todayCheckins = checkins.filter(c => c.dateIn === today);
            const waitingCount = todayCheckins.filter(c => c.status === 'waiting').length;

            // Update stats
            document.getElementById('waitingCount').textContent = waitingCount;
            document.getElementById('totalCount').textContent = todayCheckins.length;

            // Update table
            const tbody = document.getElementById('checkinsTableBody');
            tbody.innerHTML = '';

            if (todayCheckins.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 40px;">No check-ins today</td></tr>';
                return;
            }

            todayCheckins.forEach(checkin => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${checkin.timeIn}</td>
                    <td><strong>${checkin.name}</strong></td>
                    <td>${checkin.phone}</td>
                    <td>${checkin.service}</td>
                    <td>${checkin.firstVisit}</td>
                    <td class="status-${checkin.status}">${checkin.status.toUpperCase()}</td>
                    <td>
                        ${checkin.status === 'waiting' ? 
                            `<button class="btn btn-primary" onclick="checkInPatient('${checkin.id}')">Check In</button>` : 
                            `<button class="btn btn-secondary" onclick="checkOutPatient('${checkin.id}')">Check Out</button>`
                        }
                    </td>
                `;
                tbody.appendChild(row);
            });

            console.log('Dashboard refreshed. Showing', todayCheckins.length, 'check-ins');
        }

        // Check in patient
        function checkInPatient(id) {
            const checkin = checkins.find(c => c.id === id);
            if (checkin) {
                checkin.status = 'active';
                saveData();
                refreshDashboard();
            }
        }

        // Check out patient
        function checkOutPatient(id) {
            const checkin = checkins.find(c => c.id === id);
            if (checkin) {
                checkin.status = 'completed';
                saveData();
                refreshDashboard();
            }
        }

        // Update time
        function updateTime() {
            const now = new Date();
            document.getElementById('currentTime').textContent = now.toLocaleString();
        }

        // Initialize
        loadData();
        updateTime();
        updateProgress();
        setInterval(updateTime, 60000);
        setInterval(refreshDashboard, 5000); // Auto-refresh dashboard every 5 seconds

        console.log('Unified check-in system loaded. Total check-ins:', checkins.length);
    </script>
</body>
</html>