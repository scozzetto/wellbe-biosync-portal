<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Staff Knowledge Base - Be Well LifeStyle Centers</title>
    <link rel="stylesheet" href="styles.css">
    <script src="permissions-config.js"></script>
    <script src="auth-system.js"></script>
    <style>
        .auth-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: var(--bg-color);
        }
        
        .auth-box {
            background: var(--card-bg);
            padding: 40px;
            border-radius: 12px;
            border: 1px solid rgba(164, 124, 91, 0.3);
            max-width: 400px;
            width: 100%;
            text-align: center;
        }
        
        .auth-box h2 {
            color: var(--primary-color);
            margin-bottom: 20px;
        }
        
        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }
        
        .form-group label {
            color: var(--text-color);
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
        }
        
        .form-group input {
            width: 100%;
            padding: 12px;
            border: 1px solid rgba(164, 124, 91, 0.3);
            border-radius: 6px;
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-color);
            font-size: 1rem;
        }
        
        .auth-btn {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.3s ease;
            width: 100%;
        }
        
        .auth-btn:hover {
            transform: translateY(-2px);
        }
        
        .knowledge-base {
            display: none;
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
            background: var(--bg-color);
            color: var(--text-color);
            min-height: 100vh;
        }
        
        .kb-header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--primary-color);
        }
        
        .kb-header h1 {
            color: var(--primary-color);
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .kb-section {
            background: var(--card-bg);
            border-radius: 12px;
            border: 1px solid rgba(164, 124, 91, 0.2);
            margin-bottom: 25px;
            overflow: hidden;
        }
        
        .kb-section-header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 15px 20px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }
        
        .kb-section-header:hover {
            background: linear-gradient(135deg, var(--secondary-color), var(--primary-color));
        }
        
        .kb-section-header h3 {
            margin: 0;
            font-size: 1.3rem;
        }
        
        .kb-section-content {
            padding: 25px;
            display: none;
        }
        
        .kb-section.open .kb-section-content {
            display: block;
        }
        
        .kb-section.open .kb-section-header .fas {
            transform: rotate(180deg);
        }
        
        .value-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: rgba(164, 124, 91, 0.05);
            border-radius: 8px;
            overflow: hidden;
        }
        
        .value-table th,
        .value-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid rgba(164, 124, 91, 0.2);
        }
        
        .value-table th {
            background: var(--primary-color);
            color: white;
            font-weight: 600;
        }
        
        .value-table td {
            color: var(--text-color);
        }
        
        .script-box {
            background: rgba(62, 91, 61, 0.1);
            border-left: 4px solid #3E5B3D;
            padding: 15px 20px;
            margin: 15px 0;
            border-radius: 0 8px 8px 0;
        }
        
        .script-box h4 {
            color: #3E5B3D;
            margin-top: 0;
            margin-bottom: 10px;
        }
        
        .script-box p {
            margin: 5px 0;
            line-height: 1.6;
        }
        
        .highlight {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: 600;
        }
        
        .logout-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--danger-color);
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
        }
        
        /* Tab Navigation Styles */
        .tab-navigation {
            background: var(--card-bg);
            border-radius: 12px;
            margin-bottom: 25px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .tab-header {
            display: flex;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            margin: 0;
        }
        
        .tab-btn {
            flex: 1;
            padding: 15px 20px;
            background: transparent;
            color: white;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .tab-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .tab-btn.active {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .tab-btn.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: white;
        }
        
        .tab-content {
            padding: 25px;
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .admin-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .admin-card {
            background: var(--card-bg);
            border: 1px solid rgba(164, 124, 91, 0.3);
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            transition: transform 0.3s ease;
        }
        
        .admin-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .admin-card h4 {
            color: var(--primary-color);
            margin-bottom: 15px;
        }
        
        .admin-card a, .admin-card button {
            background: var(--primary-color);
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 6px;
            text-decoration: none;
            display: inline-block;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .admin-card a:hover, .admin-card button:hover {
            background: #8a6a4a;
            transform: translateY(-1px);
        }
        
        .staff-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .staff-card {
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            transition: transform 0.2s ease;
        }
        
        .staff-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .staff-card h5 {
            color: var(--primary-color);
            margin-bottom: 8px;
        }
        
        .staff-card p {
            margin: 3px 0;
            font-size: 0.9rem;
            color: #666;
        }
        
        .staff-actions {
            margin-top: 10px;
            display: flex;
            gap: 8px;
        }
        
        .staff-actions button {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .btn-activate {
            background: #28a745;
            color: white;
        }
        
        .btn-deactivate {
            background: #dc3545;
            color: white;
        }
        
        .btn-edit {
            background: #6c757d;
            color: white;
        }
    </style>
</head>
<body>
    <!-- Authentication Section -->
    <div id="auth-section" class="auth-container">
        <button style="position: fixed; top: 20px; right: 20px; background: var(--primary-color); color: white; padding: 8px 16px; border: none; border-radius: 6px; cursor: pointer; font-size: 0.9rem;" onclick="window.location.href='index.html'">
            <i class="fas fa-home"></i> Home
        </button>
        <div class="auth-box">
            <img src="logo.svg" alt="Be Well Logo" style="height: 50px; width: auto; margin-bottom: 20px; filter: brightness(0) invert(1);">
            <h2>Staff Knowledge Base</h2>
            <p style="color: #9ca3af; margin-bottom: 25px;">Enter staff password to access</p>
            
            <form id="auth-form">
                <div class="form-group">
                    <label for="password">Password:</label>
                    <input type="password" id="password" required>
                </div>
                <button type="submit" class="auth-btn">Access Knowledge Base</button>
            </form>
            
            <div id="auth-error" style="color: #ff6b6b; margin-top: 15px; display: none;">
                Incorrect password. Please try again.
            </div>
        </div>
    </div>

    <!-- Knowledge Base Content -->
    <div id="knowledge-base" class="knowledge-base">
        <div style="position: fixed; top: 20px; right: 20px; display: flex; gap: 10px;">
            <button id="adminSettingsBtn" class="logout-btn" onclick="switchTab('admin')" style="background: #dc3545; display: none;">
                <i class="fas fa-cogs"></i> Admin Dashboard
            </button>
            <button class="logout-btn" onclick="window.location.href='index.html'" style="background: var(--primary-color);">
                <i class="fas fa-home"></i> Home
            </button>
            <button class="logout-btn" onclick="logout()">
                <i class="fas fa-sign-out-alt"></i> Logout
            </button>
        </div>
        
        <div class="kb-header">
            <h1><i class="fas fa-book-open"></i> Staff Knowledge Base</h1>
            <p style="color: #9ca3af; font-size: 1.1rem;">Everything you need to know about Be Well services, memberships, patient interactions, and inventory management</p>
        </div>
        
        <!-- Main Staff Portal Tabs -->
        <div class="tab-navigation">
            <div class="tab-header">
                <button class="tab-btn active" onclick="switchTab('operations')" id="operations-tab">
                    <i class="fas fa-tools"></i> Operations
                </button>
                <button class="tab-btn" onclick="switchTab('members')" id="members-tab">
                    <i class="fas fa-users"></i> Member Management
                </button>
                <button class="tab-btn" onclick="switchTab('admin')" id="admin-tab" style="display: none;">
                    <i class="fas fa-cogs"></i> Admin Dashboard
                </button>
            </div>
            
            <!-- Operations Tab -->
            <div id="operations-content" class="tab-content active">
                <h3 style="color: var(--primary-color); margin-bottom: 20px;"><i class="fas fa-rocket"></i> Daily Operations</h3>
                <div class="admin-grid">
                    <div class="admin-card">
                        <h4><i class="fas fa-coffee"></i> Caf√© Operations</h4>
                        <p>Daily caf√© procedures and recipes</p>
                        <a href="cafe-operations-portal.html" target="_blank">Open Caf√© Portal</a>
                    </div>
                    
                    <div class="admin-card">
                        <h4><i class="fas fa-boxes"></i> Inventory Ordering</h4>
                        <p>Order supplies and manage inventory</p>
                        <a href="simple-inventory.html" target="_blank">Open Inventory</a>
                    </div>
                    
                    <div class="admin-card">
                        <h4><i class="fas fa-tasks"></i> Checklist Hub</h4>
                        <p>Daily checklists and procedures</p>
                        <a href="checklist-hub.html">Open Checklists</a>
                    </div>
                    
                    <div class="admin-card">
                        <h4><i class="fas fa-desktop"></i> Front Desk - Birmingham</h4>
                        <p>Check-in management dashboard</p>
                        <a href="front-desk-dashboard.html" target="_blank">Open Dashboard</a>
                    </div>
                    
                    <div class="admin-card">
                        <h4><i class="fas fa-clipboard-check"></i> Patient Check-In Kiosk</h4>
                        <p>For patient self check-in on iPad</p>
                        <a href="patient-checkin.html" target="_blank">Open Kiosk</a>
                    </div>
                    
                    <div class="admin-card">
                        <h4><i class="fas fa-tasks"></i> Task Management</h4>
                        <p>Team tasks and to-do lists</p>
                        <a href="task-management-v2.html">Open Tasks</a>
                    </div>
                </div>
            </div>
            
            <!-- Member Management Tab -->
            <div id="members-content" class="tab-content">
                <h3 style="color: var(--primary-color); margin-bottom: 20px;"><i class="fas fa-users"></i> Member Management</h3>
                <div class="admin-grid">
                    <div class="admin-card">
                        <h4><i class="fas fa-user-check"></i> Member Portal</h4>
                        <p>View member accounts and credits</p>
                        <a href="member-portal.html" target="_blank">Open Member Portal</a>
                    </div>
                    
                    <div class="admin-card">
                        <h4><i class="fas fa-chart-bar"></i> Member Reports</h4>
                        <p>View membership analytics and reports</p>
                        <a href="admin-dashboard.html" target="_blank">Open Reports</a>
                    </div>
                    
                    <div class="admin-card">
                        <h4><i class="fas fa-credit-card"></i> Membership Sales</h4>
                        <p>Help customers purchase memberships</p>
                        <a href="membership-purchase.html" target="_blank">Open Sales Portal</a>
                    </div>
                    
                    <div class="admin-card">
                        <h4><i class="fas fa-receipt"></i> Transaction History</h4>
                        <p>View payment and credit transactions</p>
                        <button onclick="alert('Coming Soon: Transaction history integration')">View Transactions</button>
                    </div>
                </div>
            </div>
            
            <!-- Admin Dashboard Tab (Management Only) -->
            <div id="admin-content" class="tab-content">
                <h3 style="color: var(--primary-color); margin-bottom: 20px;"><i class="fas fa-cogs"></i> Admin Dashboard</h3>
                <div class="admin-grid">
                    <div class="admin-card">
                        <h4><i class="fas fa-user-plus"></i> Staff Management</h4>
                        <p>Add, edit, and manage staff accounts</p>
                        <button onclick="showStaffManagement()">Manage Staff</button>
                    </div>
                    
                    <div class="admin-card">
                        <h4><i class="fas fa-shield-alt"></i> System Settings</h4>
                        <p>Configure system permissions and settings</p>
                        <button onclick="alert('Coming Soon: System settings panel')">Open Settings</button>
                    </div>
                    
                    <div class="admin-card">
                        <h4><i class="fas fa-history"></i> Activity Logs</h4>
                        <p>View system and user activity logs</p>
                        <button onclick="showActivityLogs()">View Logs</button>
                    </div>
                    
                    <div class="admin-card">
                        <h4><i class="fas fa-download"></i> Data Export</h4>
                        <p>Export system data and reports</p>
                        <button onclick="alert('Coming Soon: Data export functionality')">Export Data</button>
                    </div>
                </div>
                
                <!-- Staff Management Section -->
                <div id="staff-management" style="display: none; margin-top: 30px;">
                    <h4 style="color: var(--primary-color); margin-bottom: 15px;">Staff Management</h4>
                    
                    <!-- Add New Staff Form -->
                    <div style="background: #f8f9fa; border: 1px solid #e0e0e0; border-radius: 8px; padding: 20px; margin-bottom: 20px;">
                        <h5 style="color: var(--primary-color); margin-bottom: 15px;">Add New Staff Member</h5>
                        <form id="add-staff-form" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                            <div>
                                <label>Full Name:</label>
                                <input type="text" id="staff-name" required style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                            </div>
                            <div>
                                <label>Username:</label>
                                <input type="text" id="staff-username" required style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                            </div>
                            <div>
                                <label>Email:</label>
                                <input type="email" id="staff-email" required style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                            </div>
                            <div>
                                <label>Role:</label>
                                <select id="staff-role" required style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                                    <option value="">Select Role</option>
                                    <option value="staff">Staff</option>
                                    <option value="admin">Admin</option>
                                    <option value="management">Management</option>
                                </select>
                            </div>
                            <div style="grid-column: 1 / -1;">
                                <button type="submit" style="background: var(--primary-color); color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer;">
                                    <i class="fas fa-user-plus"></i> Add Staff Member
                                </button>
                            </div>
                        </form>
                    </div>
                    
                    <!-- Current Staff List -->
                    <div style="background: #f8f9fa; border: 1px solid #e0e0e0; border-radius: 8px; padding: 20px;">
                        <h5 style="color: var(--primary-color); margin-bottom: 15px;">Current Staff Members</h5>
                        <div id="staff-list" class="staff-list">
                            <!-- Staff cards will be populated here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- OLD Admin Functions Section - REPLACED BY NEW TAB SYSTEM -->
        <!-- <div id="admin-section" class="kb-section" style="background: rgba(220, 53, 69, 0.1); border: 2px solid #dc3545; margin-bottom: 30px; display: none;">
            <div class="kb-section-content" style="display: block; padding: 20px;">
                <h3 style="color: #dc3545; margin-bottom: 15px; font-size: 1.5rem;"><i class="fas fa-user-shield"></i> Admin Functions</h3>
                <p style="color: #6c757d; margin-bottom: 20px;">Administrative tools for managing staff accounts and system settings.</p>
                
                <!-- Edit Modal -->
                <div id="edit-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000;">
                    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: var(--card-bg); padding: 30px; border-radius: 8px; width: 90%; max-width: 500px;">
                        <h3 style="color: #dc3545; margin-bottom: 20px;">Edit Staff Member</h3>
                        <form id="edit-staff-form">
                            <input type="hidden" id="edit-staff-id">
                            <div style="margin-bottom: 15px;">
                                <label style="display: block; margin-bottom: 5px; font-weight: 600;">Full Name:</label>
                                <input type="text" id="edit-staff-name" required style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                            </div>
                            <div style="margin-bottom: 15px;">
                                <label style="display: block; margin-bottom: 5px; font-weight: 600;">Email:</label>
                                <input type="email" id="edit-staff-email" required style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                            </div>
                            <div style="margin-bottom: 15px;">
                                <label style="display: block; margin-bottom: 5px; font-weight: 600;">Position:</label>
                                <input type="text" id="edit-staff-position" required style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                            </div>
                            <div style="margin-bottom: 15px;">
                                <label style="display: block; margin-bottom: 5px; font-weight: 600;">Location:</label>
                                <select id="edit-staff-location" required style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                                    <option value="Birmingham">Birmingham</option>
                                    <option value="UWM">UWM</option>
                                    <option value="Berkeley">Berkeley</option>
                                    <option value="All">All Locations</option>
                                </select>
                            </div>
                            <div style="margin-bottom: 15px;">
                                <label style="display: block; margin-bottom: 5px; font-weight: 600;">Access Level:</label>
                                <select id="edit-access-level" required style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                                    <option value="admin">Administrator</option>
                                    <option value="manager">Manager</option>
                                    <option value="staff">Staff</option>
                                    <option value="cafe">Caf√© Only</option>
                                </select>
                            </div>
                            <div style="margin-bottom: 15px;">
                                <label style="display: block; margin-bottom: 5px; font-weight: 600;">Password:</label>
                                <input type="text" id="edit-staff-password" required style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                            </div>
                            <div style="display: flex; gap: 10px;">
                                <button type="submit" style="background: #198754; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer;">Save Changes</button>
                                <button type="button" onclick="closeEditModal()" style="background: #6c757d; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer;">Cancel</button>
                            </div>
                        </form>
                    </div>
                </div>
                
                <!-- Add Staff Form -->
                <div style="background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(220, 53, 69, 0.3); border-radius: 8px; padding: 20px; margin-bottom: 20px;">
                    <h4 style="color: #dc3545; margin-bottom: 15px;"><i class="fas fa-user-plus"></i> Add New Staff Member</h4>
                    <form id="admin-add-staff-form">
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 15px;">
                            <div>
                                <label style="color: var(--text-color); display: block; margin-bottom: 5px; font-weight: 600;">Full Name:</label>
                                <input type="text" id="admin-staff-name" required style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                            </div>
                            <div>
                                <label style="color: var(--text-color); display: block; margin-bottom: 5px; font-weight: 600;">Email:</label>
                                <input type="email" id="admin-staff-email" required style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                            </div>
                            <div>
                                <label style="color: var(--text-color); display: block; margin-bottom: 5px; font-weight: 600;">Position:</label>
                                <input type="text" id="admin-staff-position" required style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                            </div>
                            <div>
                                <label style="color: var(--text-color); display: block; margin-bottom: 5px; font-weight: 600;">Location:</label>
                                <select id="admin-staff-location" required style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                                    <option value="">Select Location</option>
                                    <option value="Birmingham">Birmingham</option>
                                    <option value="UWM">UWM</option>
                                    <option value="Berkeley">Berkeley</option>
                                    <option value="All">All Locations</option>
                                </select>
                            </div>
                            <div>
                                <label style="color: var(--text-color); display: block; margin-bottom: 5px; font-weight: 600;">Access Level:</label>
                                <select id="admin-access-level" required style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                                    <option value="">Select Access Level</option>
                                    <option value="admin">Administrator</option>
                                    <option value="manager">Manager</option>
                                    <option value="staff">Staff</option>
                                    <option value="cafe">Caf√© Only</option>
                                </select>
                            </div>
                            <div>
                                <label style="color: var(--text-color); display: block; margin-bottom: 5px; font-weight: 600;">Password:</label>
                                <input type="text" id="admin-staff-password" placeholder="Auto-generated if empty" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                            </div>
                        </div>
                        <button type="submit" style="background: #dc3545; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; font-weight: 600;">
                            <i class="fas fa-user-plus"></i> Add Staff Member
                        </button>
                    </form>
                </div>
                
                <!-- Current Staff List -->
                <div style="background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(220, 53, 69, 0.3); border-radius: 8px; padding: 20px;">
                    <h4 style="color: #dc3545; margin-bottom: 15px;"><i class="fas fa-users"></i> Current Staff Members</h4>
                    <div id="admin-staff-list" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 15px;">
                        <!-- Staff cards will be populated here -->
                    </div>
                </div>
            </div>
        </div> -->

        <!-- Membership Benefits Section -->
        <div class="kb-section">
            <div class="kb-section-header" onclick="toggleSection(this)">
                <h3><i class="fas fa-credit-card"></i> Membership Benefits & Value Explanations</h3>
                <i class="fas fa-chevron-down"></i>
            </div>
            <div class="kb-section-content">
                <h4>Quick Value Explanations for Patients:</h4>
                
                <div class="script-box">
                    <h4>Restore - $149/mo</h4>
                    <p><strong>Script:</strong> "If you get even <span class="highlight">ONE massage per month</span>, you save money. A regular massage costs $115, but with Restore it's included PLUS you earn $15 in credits. You basically get your massage for $100 AND build credits for other services."</p>
                </div>
                
                <div class="script-box">
                    <h4>Revive - $299/mo</h4>
                    <p><strong>Script:</strong> "Perfect for <span class="highlight">bi-weekly massage clients</span>. Two massages normally cost $230/month. With Revive, both are included for $299. You pay only $70 more but get $30 in credits PLUS 10% off everything else. Net cost: only $40 more for tons of extra benefits."</p>
                </div>
                
                <div class="script-box">
                    <h4>Renew - $499/mo (MOST POPULAR)</h4>
                    <p><strong>Script:</strong> "Great for people who get <span class="highlight">multiple services</span>. A massage + IV + chiro normally costs $425. With Renew, all three are included for $499. You pay $75 more but get $50 in credits PLUS 10% off PLUS caf√© perks. Essentially break-even with massive extra benefits."</p>
                </div>
                
                <div class="script-box">
                    <h4>Total Wellness - $799/mo</h4>
                    <p><strong>Script:</strong> "For our <span class="highlight">wellness enthusiasts</span>. Five services could easily be $700+. With Total Wellness, all are included for $799 PLUS you get $80 in credits monthly PLUS weekly caf√© items. Perfect for comprehensive wellness."</p>
                </div>

                <h4>Key Talking Points:</h4>
                <ul style="color: var(--text-color); line-height: 1.8;">
                    <li><strong>"Think about what you already spend here monthly"</strong></li>
                    <li><strong>"The credits build up - it's like earning cash back"</strong></li>
                    <li><strong>"10% off applies to EVERYTHING, including future add-ons"</strong></li>
                    <li><strong>"The more services you use, the more you save"</strong></li>
                    <li><strong>"Credits expire in 6 months, so use them for extras you want to try"</strong></li>
                </ul>

                <table class="value-table">
                    <thead>
                        <tr>
                            <th>Membership</th>
                            <th>Monthly Fee</th>
                            <th>Services Included</th>
                            <th>Credits Earned</th>
                            <th>Best For</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Restore</td>
                            <td>$149</td>
                            <td>Pick 1 service</td>
                            <td>$14.90</td>
                            <td>Monthly massage clients</td>
                        </tr>
                        <tr>
                            <td>Revive</td>
                            <td>$299</td>
                            <td>Pick 2 services</td>
                            <td>$29.90</td>
                            <td>Bi-weekly massage clients</td>
                        </tr>
                        <tr>
                            <td>Renew</td>
                            <td>$499</td>
                            <td>Pick 3 services</td>
                            <td>$49.90</td>
                            <td>Multi-service users</td>
                        </tr>
                        <tr>
                            <td>Total Wellness</td>
                            <td>$799</td>
                            <td>Pick 5 services</td>
                            <td>$79.90</td>
                            <td>Wellness enthusiasts</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Service Pricing Section -->
        <div class="kb-section">
            <div class="kb-section-header" onclick="toggleSection(this)">
                <h3><i class="fas fa-dollar-sign"></i> Service Pricing Reference</h3>
                <i class="fas fa-chevron-down"></i>
            </div>
            <div class="kb-section-content">
                <table class="value-table">
                    <thead>
                        <tr>
                            <th>Service</th>
                            <th>Duration</th>
                            <th>Cash Price</th>
                            <th>Member Price (10% off)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Chiropractic</td>
                            <td>Varies</td>
                            <td>$85-90</td>
                            <td>$76.50-81</td>
                        </tr>
                        <tr>
                            <td>Massage - 60min</td>
                            <td>1 hour</td>
                            <td>$115</td>
                            <td>$103.50</td>
                        </tr>
                        <tr>
                            <td>Massage - 90min</td>
                            <td>1.5 hours</td>
                            <td>$170</td>
                            <td>$153</td>
                        </tr>
                        <tr>
                            <td>Colon Hydrotherapy</td>
                            <td>1 hour</td>
                            <td>$120-125</td>
                            <td>$108-112.50</td>
                        </tr>
                        <tr>
                            <td>IV Therapy (Basic)</td>
                            <td>30-60 mins</td>
                            <td>$190-255</td>
                            <td>$171-229.50</td>
                        </tr>
                        <tr>
                            <td>NAD+ IV</td>
                            <td>2-3 hours</td>
                            <td>$350-500</td>
                            <td>$315-450</td>
                        </tr>
                        <tr>
                            <td>Vitamin Shots</td>
                            <td>5 mins</td>
                            <td>$30-65</td>
                            <td>$27-58.50</td>
                        </tr>
                        <tr>
                            <td>Cupping</td>
                            <td>15-30 mins</td>
                            <td>$80</td>
                            <td>$72</td>
                        </tr>
                        <tr>
                            <td>Dry Needling</td>
                            <td>20 mins</td>
                            <td>$60-80</td>
                            <td>$54-72</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Common Questions Section -->
        <div class="kb-section">
            <div class="kb-section-header" onclick="toggleSection(this)">
                <h3><i class="fas fa-question-circle"></i> Common Patient Questions</h3>
                <i class="fas fa-chevron-down"></i>
            </div>
            <div class="kb-section-content">
                <div class="script-box">
                    <h4>"What happens to my credits if I cancel?"</h4>
                    <p><strong>Answer:</strong> "Reserve credits are non-refundable if you cancel your membership. However, credits do carry over month to month and you have 6 months to use them, so you have plenty of time to enjoy the benefits before they expire."</p>
                </div>
                
                <div class="script-box">
                    <h4>"Can I change my membership level?"</h4>
                    <p><strong>Answer:</strong> "Absolutely! You can upgrade or downgrade at any time. Changes take effect with your next billing cycle. Any unused service allowances don't carry over, but your Reserve credits stay with you."</p>
                </div>
                
                <div class="script-box">
                    <h4>"What if I don't use all my services in a month?"</h4>
                    <p><strong>Answer:</strong> "Service allowances reset each month - they don't roll over. However, you're earning Reserve credits every month that you can use anytime for additional services. Think of the service allowances as your base benefits, and credits as your bonus savings."</p>
                </div>
                
                <div class="script-box">
                    <h4>"Can I share my membership with family?"</h4>
                    <p><strong>Answer:</strong> "Memberships are individual accounts. However, you can use your Reserve credits to pay for family members' services, and they'll still get the 10% member discount when you pay."</p>
                </div>
            </div>
        </div>

        <!-- Contact Information Section -->
        <div class="kb-section">
            <div class="kb-section-header" onclick="toggleSection(this)">
                <h3><i class="fas fa-phone"></i> Important Contacts & Resources</h3>
                <i class="fas fa-chevron-down"></i>
            </div>
            <div class="kb-section-content">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                    <div style="background: rgba(164, 124, 91, 0.1); padding: 20px; border-radius: 8px;">
                        <h4 style="color: var(--primary-color);">Emergency Contacts</h4>
                        <p>Main Line: (248) 792-6570</p>
                        <p>Manager: [Add contact]</p>
                        <p>Owner: [Add contact]</p>
                    </div>
                    
                    <div style="background: rgba(164, 124, 91, 0.1); padding: 20px; border-radius: 8px;">
                        <h4 style="color: var(--primary-color);">Quick Links</h4>
                        <p><a href="https://book.squareup.com/appointments/6pyjoccl1ik8ur/location/101VJFBVK1T29/services" target="_blank" style="color: var(--primary-color);">Booking System</a></p>
                        <p><a href="https://be-well-lifestyle-centers.square.site/" target="_blank" style="color: var(--primary-color);">Caf√© Ordering</a></p>
                        <p><a href="membership-purchase.html" target="_blank" style="color: var(--primary-color);">Membership Purchase</a></p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Salesforce Chatter Guide Section -->
        <div class="kb-section">
            <div class="kb-section-header" onclick="toggleSection(this)">
                <h3><i class="fas fa-comments"></i> Salesforce Chatter - Staff Communication Guide</h3>
                <i class="fas fa-chevron-down"></i>
            </div>
            <div class="kb-section-content">
                <div style="background: rgba(62, 91, 61, 0.1); border-left: 4px solid #3E5B3D; padding: 20px; margin-bottom: 20px; border-radius: 8px;">
                    <h4 style="color: #3E5B3D; margin-top: 0;">What is Chatter?</h4>
                    <p>Chatter is our internal messaging system built into Salesforce. Think of it as "Facebook for work" - you can post updates, message teammates, and stay connected across all Be Well locations.</p>
                </div>

                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 30px;">
                    <div style="background: rgba(164, 124, 91, 0.1); padding: 20px; border-radius: 8px;">
                        <h4 style="color: var(--primary-color);"><i class="fas fa-mobile-alt"></i> Getting Started</h4>
                        <ol style="margin-left: 20px;">
                            <li><strong>Desktop:</strong> Log into Salesforce ‚Üí Click "App Launcher" (9 dots) ‚Üí Select "Chatter"</li>
                            <li><strong>Mobile:</strong> Download "Salesforce Mobile" app ‚Üí Login ‚Üí Tap Chatter icon at bottom</li>
                            <li><strong>Notifications:</strong> Enable push notifications to never miss important messages</li>
                        </ol>
                    </div>
                    
                    <div style="background: rgba(164, 124, 91, 0.1); padding: 20px; border-radius: 8px;">
                        <h4 style="color: var(--primary-color);"><i class="fas fa-users"></i> Join Your Groups</h4>
                        <p><strong>Required Groups to Join:</strong></p>
                        <ul style="margin-left: 20px;">
                            <li>üìç Your location team (Birmingham/Berkeley/UWM)</li>
                            <li>üë• All Be Well Staff</li>
                            <li>üè• Your department (Front Desk, Providers, etc.)</li>
                        </ul>
                        <p style="margin-top: 10px;"><em>To join: Click Groups ‚Üí Search ‚Üí Join</em></p>
                    </div>
                </div>

                <div style="background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; border: 2px solid var(--primary-color);">
                    <h4 style="color: var(--primary-color);"><i class="fas fa-comment-dots"></i> How to Use Chatter Effectively</h4>
                    
                    <div style="margin-bottom: 20px;">
                        <h5 style="color: #3E5B3D;">Making Posts:</h5>
                        <ul style="margin-left: 20px; color: #333;">
                            <li><strong style="color: #000;">@mention specific people:</strong> Type @ then their name (e.g., @SallySmith)</li>
                            <li><strong style="color: #000;">Use hashtags:</strong> #urgent #schedulechange #help</li>
                            <li><strong style="color: #000;">Attach photos:</strong> Click üìé to add images (great for inventory issues)</li>
                            <li><strong style="color: #000;">Polls:</strong> Create quick polls for team decisions</li>
                        </ul>
                    </div>

                    <div style="margin-bottom: 20px;">
                        <h5 style="color: #3E5B3D;">Common Use Cases:</h5>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                            <div style="background: #f8f8f8; padding: 15px; border-radius: 6px; border: 1px solid #ddd; color: #333;">
                                <strong style="color: #000;">Schedule Changes:</strong><br>
                                "Hey @DrJones, your 3pm patient rescheduled to 4pm"
                            </div>
                            <div style="background: #f8f8f8; padding: 15px; border-radius: 6px; border: 1px solid #ddd; color: #333;">
                                <strong style="color: #000;">Coverage Requests:</strong><br>
                                "@FrontDeskTeam Can someone cover my lunch 12-1pm?"
                            </div>
                            <div style="background: #f8f8f8; padding: 15px; border-radius: 6px; border: 1px solid #ddd; color: #333;">
                                <strong style="color: #000;">Patient Updates:</strong><br>
                                "FYI @Birmingham Mrs. Johnson running 15 min late"
                            </div>
                            <div style="background: #f8f8f8; padding: 15px; border-radius: 6px; border: 1px solid #ddd; color: #333;">
                                <strong style="color: #000;">Supply Issues:</strong><br>
                                "@Managers We're out of parking validation stamps"
                            </div>
                        </div>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                    <div style="background: rgba(76, 175, 80, 0.1); padding: 20px; border-radius: 8px; border: 1px solid #4caf50;">
                        <h4 style="color: #2e7d32;"><i class="fas fa-check-circle"></i> Do's</h4>
                        <ul style="margin-left: 20px;">
                            <li>‚úÖ Keep messages professional and brief</li>
                            <li>‚úÖ Use @mentions for urgent items</li>
                            <li>‚úÖ Check Chatter at start/end of shift</li>
                            <li>‚úÖ Update your status (Available/Busy/Out)</li>
                            <li>‚úÖ Acknowledge important messages with üëç</li>
                            <li>‚úÖ Post in appropriate groups</li>
                        </ul>
                    </div>
                    
                    <div style="background: rgba(244, 67, 54, 0.1); padding: 20px; border-radius: 8px; border: 1px solid #f44336;">
                        <h4 style="color: #c62828;"><i class="fas fa-times-circle"></i> Don'ts</h4>
                        <ul style="margin-left: 20px;">
                            <li>‚ùå Share patient PHI or sensitive info</li>
                            <li>‚ùå Post personal/non-work content</li>
                            <li>‚ùå Use ALL CAPS (it's like yelling)</li>
                            <li>‚ùå Ignore urgent @mentions</li>
                            <li>‚ùå Post complaints publicly</li>
                            <li>‚ùå Share login credentials</li>
                        </ul>
                    </div>
                </div>

                <div style="background: rgba(255, 193, 7, 0.15); padding: 20px; border-radius: 8px; margin-top: 20px; border: 1px solid #ffc107;">
                    <h4 style="color: #856404;"><i class="fas fa-lightbulb"></i> Pro Tips</h4>
                    <ul style="margin-left: 20px;">
                        <li>üì± <strong>Mobile First:</strong> Use the mobile app for quick updates throughout your day</li>
                        <li>üîî <strong>Custom Notifications:</strong> Set different sounds for @mentions vs general posts</li>
                        <li>üì∏ <strong>Photo Power:</strong> A picture is worth 1000 words - use photos for inventory/maintenance issues</li>
                        <li>‚≠ê <strong>Follow Important People:</strong> Follow providers and managers to see their updates first</li>
                        <li>üìå <strong>Pin Important Posts:</strong> Pin announcements to keep them at the top of feeds</li>
                        <li>üîç <strong>Search is Powerful:</strong> Search old posts to find answers before asking again</li>
                    </ul>
                </div>

                <div style="text-align: center; margin-top: 30px; padding: 20px; background: rgba(164, 124, 91, 0.1); border-radius: 8px;">
                    <h4 style="color: var(--primary-color);">Need Help?</h4>
                    <p>Post in <strong>@AllStaff</strong> group with <strong>#ChatterHelp</strong> and someone will assist you!</p>
                    <p style="margin-top: 10px;">Remember: Chatter keeps our teams connected across all locations. Use it wisely! üí™</p>
                </div>
            </div>
        </div>

    </div>

    <script>
        // Initialize page with new authentication system
        document.addEventListener('DOMContentLoaded', function() {
            // Check authentication first
            if (!requireAuth('staff-knowledge-base')) {
                return; // Will redirect if not authenticated
            }
            
            // Get current user and show welcome message
            const currentUser = getCurrentUser();
            if (currentUser) {
                // Update welcome message
                document.querySelector('.kb-header p').innerHTML = `Welcome back, <strong>${currentUser.full_name}</strong> (${currentUser.role.toUpperCase()}) - Access Level: ${currentUser.role}<br><small style="color: #10b981;">‚úÖ Authentication successful</small>`;
                
                // Show admin settings button for management users
                if (currentUser.role === 'management') {
                    document.getElementById('adminSettingsBtn').style.display = 'block';
                }
                
                // Hide the authentication section and show knowledge base
                document.getElementById('auth-section').style.display = 'none';
                document.getElementById('knowledge-base').style.display = 'block';
                
                // Update access permissions based on role
                updateAccessPermissions(currentUser.role);
            }
        });
        
        // Legacy variables for compatibility
        let staffData = [];
        let currentUser = null;
        
        // Legacy compatibility - no longer used
        
        // Legacy authentication setup - replaced with new auth system
        function setupAuthentication() {
            // No longer needed - handled by auth-system.js
        }
        
        // Access permissions based on role
        function updateAccessPermissions(role) {
            const adminSection = document.getElementById('admin-section');
            
            // Show/hide admin functions based on role
            if (role === 'management') {
                // Management users get access to everything including admin section
                if (adminSection) {
                    adminSection.style.display = 'block';
                    initializeAdminForms();
                    loadAdminStaffData();
                }
            } else if (role === 'admin') {
                // Admin users get most access but not admin user management
                if (adminSection) {
                    adminSection.style.display = 'none';
                }
            } else if (role === 'staff') {
                // Staff users get limited access
                if (adminSection) {
                    adminSection.style.display = 'none';
                }
                
                // Hide certain administrative links for staff
                const allLinks = document.querySelectorAll('.kb-section a');
                allLinks.forEach(link => {
                    if (link.href.includes('admin-dashboard') || 
                        link.onclick && link.onclick.toString().includes('Admin')) {
                        link.style.display = 'none';
                    }
                });
            }
        }
        
        // Legacy functions - replaced by auth-system.js
        
        // Logout function
        function logout() {
            if (window.authSystem) {
                window.authSystem.logout();
            } else {
                // Fallback logout
                sessionStorage.clear();
                localStorage.clear();
                window.location.href = '/staff-auth.html';
            }
        }
        
        // Open dashboard in new window
        function openDashboard() {
            window.open('front-desk-dashboard.html', '_blank');
        }
        
        // Open admin dashboard in new window
        function openAdminDashboard() {
            window.open('admin-dashboard.html', '_blank');
        }
        
        // Open staff admin dashboard in new window
        function openStaffAdmin() {
            window.open('staff-admin-dashboard.html', '_blank');
        }
        
        // Toggle sections
        function toggleSection(header) {
            const section = header.parentElement;
            section.classList.toggle('open');
        }
        
        // Auto-logout handled by auth-system.js
        
        // Admin Functions (integrated into staff portal)
        function setupAdminFunctions() {
            const form = document.getElementById('admin-add-staff-form');
            if (!form) return;
            
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const name = document.getElementById('admin-staff-name').value;
                const email = document.getElementById('admin-staff-email').value;
                const position = document.getElementById('admin-staff-position').value;
                const location = document.getElementById('admin-staff-location').value;
                const accessLevel = document.getElementById('admin-access-level').value;
                let password = document.getElementById('admin-staff-password').value;
                
                if (!password) {
                    password = generateAdminPassword();
                }
                
                const newStaff = {
                    id: 'staff-' + Date.now(),
                    name,
                    email,
                    position,
                    location,
                    accessLevel,
                    password,
                    active: true,
                    created: new Date().toISOString()
                };
                
                // Add to localStorage
                let staffData = JSON.parse(localStorage.getItem('staffData')) || [];
                staffData.push(newStaff);
                localStorage.setItem('staffData', JSON.stringify(staffData));
                
                alert(`‚úÖ Staff member added successfully!\n\nName: ${name}\nEmail: ${email}\nPassword: ${password}\n\nMake sure to share the password securely with the staff member.`);
                
                form.reset();
                loadAdminStaffData();
            });
        }
        
        function generateAdminPassword() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$';
            let password = '';
            for (let i = 0; i < 12; i++) {
                password += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return password;
        }
        
        function loadAdminStaffData() {
            const staffList = document.getElementById('admin-staff-list');
            if (!staffList) return;
            
            // Always load from localStorage for admin view to see real passwords
            let staffData = JSON.parse(localStorage.getItem('staffData')) || [];
            
            // If localStorage is empty, initialize with defaults
            if (staffData.length === 0) {
                staffData = [
                    {
                        id: 'admin-001',
                        name: 'System Administrator',
                        email: 'admin@bewelllifestylecenters.com',
                        position: 'Administrator',
                        location: 'All',
                        accessLevel: 'admin',
                        password: '$Be7926570!ADMIN',
                        active: true
                    },
                    {
                        id: 'staff-001',
                        name: 'General Staff',
                        email: 'staff@bewelllifestylecenters.com',
                        position: 'Staff Member',
                        location: 'All',
                        accessLevel: 'staff',
                        password: '$Be7926570!',
                        active: true
                    }
                ];
                localStorage.setItem('staffData', JSON.stringify(staffData));
            }
            
            // Auto-fix any hidden passwords
            let needsUpdate = false;
            staffData = staffData.map(staff => {
                if (staff.password === '***HIDDEN***') {
                    if (staff.id === 'admin-001' || staff.email === 'admin@bewelllifestylecenters.com') {
                        staff.password = '$Be7926570!ADMIN';
                        needsUpdate = true;
                    } else if (staff.id === 'staff-001' || staff.email === 'staff@bewelllifestylecenters.com') {
                        staff.password = '$Be7926570!';
                        needsUpdate = true;
                    }
                }
                return staff;
            });
            
            if (needsUpdate) {
                localStorage.setItem('staffData', JSON.stringify(staffData));
            }
            
            staffList.innerHTML = '';
            
            staffData.forEach(staff => {
                const card = document.createElement('div');
                card.style.cssText = 'background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(220, 53, 69, 0.3); border-radius: 6px; padding: 15px;';
                
                const accessColor = {
                    'admin': '#dc3545',
                    'manager': '#fd7e14',
                    'staff': '#198754',
                    'cafe': '#0dcaf0'
                };
                
                // Force display of actual passwords for known default accounts
                let displayPassword = staff.password;
                if (staff.id === 'admin-001' && displayPassword === '***HIDDEN***') {
                    displayPassword = '$Be7926570!ADMIN';
                } else if (staff.id === 'staff-001' && displayPassword === '***HIDDEN***') {
                    displayPassword = '$Be7926570!';
                }
                
                card.innerHTML = `
                    <h5 style="margin: 0 0 8px 0; color: var(--primary-color);">${staff.name}</h5>
                    <p style="margin: 3px 0; color: var(--text-color); font-size: 0.9rem;"><strong>Email:</strong> ${staff.email}</p>
                    <p style="margin: 3px 0; color: var(--text-color); font-size: 0.9rem;"><strong>Position:</strong> ${staff.position}</p>
                    <p style="margin: 3px 0; color: var(--text-color); font-size: 0.9rem;"><strong>Location:</strong> ${staff.location}</p>
                    <p style="margin: 3px 0; color: var(--text-color); font-size: 0.9rem;"><strong>Password:</strong> <span style="font-family: monospace; background: rgba(0,0,0,0.1); padding: 2px 4px; border-radius: 3px;">${displayPassword}</span></p>
                    <span style="background: ${accessColor[staff.accessLevel] || '#6c757d'}; color: white; padding: 2px 6px; border-radius: 3px; font-size: 0.8rem; text-transform: uppercase;">${staff.accessLevel}</span>
                    <div style="margin-top: 10px;">
                        <button onclick="editStaff('${staff.id}')" style="background: #0dcaf0; color: white; border: none; padding: 4px 8px; border-radius: 3px; font-size: 0.8rem; cursor: pointer;">Edit</button>
                        <button onclick="deleteStaff('${staff.id}')" style="background: #dc3545; color: white; border: none; padding: 4px 8px; border-radius: 3px; font-size: 0.8rem; cursor: pointer; margin-left: 5px;">Delete</button>
                    </div>
                `;
                
                staffList.appendChild(card);
            });
        }
        
        function deleteStaff(staffId) {
            if (!confirm('Are you sure you want to delete this staff member?')) return;
            
            let staffData = JSON.parse(localStorage.getItem('staffData')) || [];
            staffData = staffData.filter(s => s.id !== staffId);
            localStorage.setItem('staffData', JSON.stringify(staffData));
            
            loadAdminStaffData();
        }
        
        function editStaff(staffId) {
            const staffData = JSON.parse(localStorage.getItem('staffData')) || [];
            const staff = staffData.find(s => s.id === staffId);
            
            if (!staff) return;
            
            // Populate edit form
            document.getElementById('edit-staff-id').value = staff.id;
            document.getElementById('edit-staff-name').value = staff.name;
            document.getElementById('edit-staff-email').value = staff.email;
            document.getElementById('edit-staff-position').value = staff.position;
            document.getElementById('edit-staff-location').value = staff.location;
            document.getElementById('edit-access-level').value = staff.accessLevel;
            document.getElementById('edit-staff-password').value = staff.password;
            
            // Show modal
            document.getElementById('edit-modal').style.display = 'block';
        }
        
        function closeEditModal() {
            document.getElementById('edit-modal').style.display = 'none';
        }
        
        // Setup edit form handler
        function setupEditForm() {
            const form = document.getElementById('edit-staff-form');
            if (!form) return;
            
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const staffId = document.getElementById('edit-staff-id').value;
                let staffData = JSON.parse(localStorage.getItem('staffData')) || [];
                const staffIndex = staffData.findIndex(s => s.id === staffId);
                
                if (staffIndex !== -1) {
                    staffData[staffIndex] = {
                        ...staffData[staffIndex],
                        name: document.getElementById('edit-staff-name').value,
                        email: document.getElementById('edit-staff-email').value,
                        position: document.getElementById('edit-staff-position').value,
                        location: document.getElementById('edit-staff-location').value,
                        accessLevel: document.getElementById('edit-access-level').value,
                        password: document.getElementById('edit-staff-password').value
                    };
                    
                    localStorage.setItem('staffData', JSON.stringify(staffData));
                    
                    alert('‚úÖ Staff member updated successfully!');
                    closeEditModal();
                    loadAdminStaffData();
                }
            });
        }
        
        // Call this when admin functions are set up
        function initializeAdminForms() {
            setupAdminFunctions();
            setupEditForm();
        }
        
        // Tab Navigation Functions
        function switchTab(tabName) {
            // Hide all tab contents
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(content => {
                content.classList.remove('active');
            });
            
            // Remove active class from all tab buttons
            const tabButtons = document.querySelectorAll('.tab-btn');
            tabButtons.forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected tab content
            document.getElementById(tabName + '-content').classList.add('active');
            document.getElementById(tabName + '-tab').classList.add('active');
        }
        
        // Staff Management Functions
        function showStaffManagement() {
            const staffMgmt = document.getElementById('staff-management');
            if (staffMgmt.style.display === 'none') {
                staffMgmt.style.display = 'block';
                loadStaffList();
            } else {
                staffMgmt.style.display = 'none';
            }
        }
        
        function loadStaffList() {
            const staffList = document.getElementById('staff-list');
            
            // Get staff from authentication system
            const demoStaff = [
                {
                    id: 'demo-admin-001',
                    name: 'System Administrator',
                    username: 'admin',
                    email: 'admin@bewelllifestylecenters.com',
                    role: 'management',
                    active: true
                },
                {
                    id: 'demo-staff-001',
                    name: 'General Staff Member',
                    username: 'staff',
                    email: 'staff@bewelllifestylecenters.com',
                    role: 'staff',
                    active: true
                }
            ];
            
            // Add any locally created staff
            const localStaff = JSON.parse(localStorage.getItem('created_users') || '[]');
            const allStaff = [...demoStaff, ...localStaff];
            
            staffList.innerHTML = '';
            
            allStaff.forEach(staff => {
                const staffCard = document.createElement('div');
                staffCard.className = 'staff-card';
                
                const isDemo = staff.id.startsWith('demo-');
                
                staffCard.innerHTML = `
                    <h5>${staff.name}</h5>
                    <p><strong>Username:</strong> ${staff.username}</p>
                    <p><strong>Email:</strong> ${staff.email}</p>
                    <p><strong>Role:</strong> <span style="text-transform: uppercase; font-weight: 600; color: var(--primary-color);">${staff.role}</span></p>
                    <p><strong>Status:</strong> <span style="color: ${staff.active ? '#28a745' : '#dc3545'};">${staff.active ? 'Active' : 'Inactive'}</span></p>
                    <div class="staff-actions">
                        ${!isDemo ? `
                            <button class="${staff.active ? 'btn-deactivate' : 'btn-activate'}" onclick="toggleStaffStatus('${staff.id}', ${!staff.active})">
                                <i class="fas fa-${staff.active ? 'ban' : 'check'}"></i> ${staff.active ? 'Deactivate' : 'Activate'}
                            </button>
                        ` : '<small style="color: #666;">Demo Account</small>'}
                        <button class="btn-edit" onclick="editStaff('${staff.id}')">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                    </div>
                `;
                
                staffList.appendChild(staffCard);
            });
        }
        
        function toggleStaffStatus(staffId, newStatus) {
            const localStaff = JSON.parse(localStorage.getItem('created_users') || '[]');
            const staffIndex = localStaff.findIndex(s => s.id === staffId);
            
            if (staffIndex !== -1) {
                localStaff[staffIndex].active = newStatus;
                localStorage.setItem('created_users', JSON.stringify(localStaff));
                
                // If deactivating, also invalidate their session
                if (!newStatus && window.authSystem) {
                    window.authSystem.logoutUser(localStaff[staffIndex].username);
                }
                
                loadStaffList();
                alert(`Staff member ${newStatus ? 'activated' : 'deactivated'} successfully!`);
            }
        }
        
        function editStaff(staffId) {
            alert('Staff editing functionality will be available in the next update. For now, staff can be deactivated/activated.');
        }
        
        function showActivityLogs() {
            if (window.authSystem && window.authSystem.getAuthLogs) {
                const logs = window.authSystem.getAuthLogs();
                
                let logDisplay = 'Recent Activity Logs:\n\n';
                logs.slice(-10).reverse().forEach(log => {
                    logDisplay += `${new Date(log.timestamp).toLocaleString()} - ${log.event} - ${log.username}\n`;
                });
                
                alert(logDisplay || 'No activity logs found.');
            } else {
                alert('Activity logs will be available when connected to the authentication database.');
            }
        }
        
        // Add staff form handler
        document.addEventListener('DOMContentLoaded', function() {
            const addStaffForm = document.getElementById('add-staff-form');
            if (addStaffForm) {
                addStaffForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    
                    const name = document.getElementById('staff-name').value;
                    const username = document.getElementById('staff-username').value;
                    const email = document.getElementById('staff-email').value;
                    const role = document.getElementById('staff-role').value;
                    
                    // Generate a secure password
                    const password = 'BeWell2024!' + Math.random().toString(36).substring(2, 8);
                    
                    const newStaff = {
                        id: 'staff-' + Date.now(),
                        username: username,
                        full_name: name,
                        email: email,
                        role: role,
                        active: true,
                        created: new Date().toISOString()
                    };
                    
                    // Store locally for demo
                    const localStaff = JSON.parse(localStorage.getItem('created_users') || '[]');
                    localStaff.push(newStaff);
                    localStorage.setItem('created_users', JSON.stringify(localStaff));
                    
                    // Try to create through auth system if available
                    if (window.authSystem && window.authSystem.createUser) {
                        try {
                            await window.authSystem.createUser({
                                username: username,
                                password: password,
                                email: email,
                                full_name: name,
                                role: role
                            });
                        } catch (error) {
                            console.log('Auth system not available, using local storage');
                        }
                    }
                    
                    alert(`‚úÖ Staff member added successfully!\n\nName: ${name}\nUsername: ${username}\nPassword: ${password}\n\nMake sure to share the credentials securely!`);
                    
                    addStaffForm.reset();
                    loadStaffList();
                });
            }
        });
        
        // Update access permissions to show admin tab for management users
        function updateAccessPermissions(role) {
            const adminTab = document.getElementById('admin-tab');
            if (role === 'management') {
                adminTab.style.display = 'block';
            } else {
                adminTab.style.display = 'none';
            }
        }
        
    </script>
    <!-- Auto-backup system -->
    <script src="auto-backup.js"></script>
</body>
</html>